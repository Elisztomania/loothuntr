<div class="container">
<% if current_user.is_member_of?(@guild) %>

    <h1 class="text-center pt-16 text-2xl">Tableau de bord : <%= @guild.name %>
<!-- BUTTON MODIF GUILDE QUE PAR CREATOR-->
      <% if current_user == @guild.creator %>
        <%= link_to edit_guild_path(@guild) do %>
          <i class="fas fa-pencil-alt text-sm"></i>
        <% end %>
      <% end %>
    </h1>

<!-- GRID -->
<div class="mx-10 py-8">
   <div class="grid gap-6 mb-8 grid-cols-2">

<!-- FORMULAIRE POSTS ORGA -->
    <div class="min-w-0 p-4 bg-white rounded-xl border border-gray-300 h-80">
      <h2 class="text-xl text-center">Ajouter un message</h2>
      <p class="italic"><%= simple_form_for [@guild, @post_new] do |f| %>
        <%= f.hidden_field :category, value: 'orga' %>
        <%= f.input :title, label: 'Titre'  %>
        <%= f.input :description, label: 'Description' %>
        <%= f.button :submit, '>', class: 'btn-dash publication' %>
      <% end %><p>
    </div>


<!-- DEBUT LISTE MEMBRES DE LA GUIDE -->
  <div class="min-w-0 p-4 bg-white rounded-xl border border-gray-300 h-auto">
    <h2 class="text-xl text-center">La guilde</h2>
    <% @guild.members.each do |member| %>
        <% if member.accepted == true %>
          <p><%= image_tag member.user.photo, class: "avatar"%>
          <%= member.user.username %></p>
          <p><%= member.user.bio %></p>
        <% end %>
    <% end %>
  </div>
<!-- FIN LISTE MEMBRES DE LA GUIDE -->


<!-- AFFICHAGE POSTS ORGA -->
  <div class="min-w-0 p-4 bg-white rounded-xl border border-gray-300 h-96 overflow-auto">
    <h2 class="text-xl text-center">Derniers posts</h2>
      <% @guild.posts.reverse_each do |post| %>
        <% if post.category == "orga" %>
        <div class="p-2 rounded-xl bg-gray-50 my-2">
          <strong><h3><%= post.title %></h3></strong>
          <p><%= post.description %></p>

          <div class="p-2 comments">
            <% post.comments.each do |comment| %>
            <div class="bg-gray-100 my-1 rounded-xl p-2 flex">
              <p><%= image_tag comment.user.photo, class: "avatar-mini"%><m class="italic text-sm username"><%= comment.user.username %> : </m><g class="content"><%= comment.content %></g></p>
            </div>
            <% end %>

            <p><%= simple_form_for [post, @comment_new] do |f| %>
              <%= f.input_field :content, label: false, placeholder: "Votre commentaire" %>
              <%= f.button :submit, '>', class: 'btn-dash commentaire' %>
            <% end %></p>
          </div>
        </div>
        <% end %>
      <% end %>
    </div>

  <div class="space-y-6">
<!-- BUTTON PISTE-->
  <!-- <%= link_to 'Voir les pistes en cours', pistes_guild_posts_path(@guild), class: "btn btn-primary" %> -->
  <%= link_to pistes_guild_posts_path(@guild) do %>
    <div class="block min-w-0 mb-4 p-4 bg-white rounded-xl border border-gray-300 h-40">
      <h2 class="text-xl text-center">Les diffÃ©rentes pistes en cours ğŸ‘€</h2>
    </div>
  <% end %>

<!-- BUTTON QUEST-->
  <!-- <%= link_to 'Voir la quÃªte', quest_path(@guild.quest), class: "btn btn-primary" %>-->
  <%= link_to quest_path(@guild.quest) do %>
    <div class="block min-w-0 p-4 bg-white rounded-xl border border-gray-300 h-40">
      <h2 class="text-xl text-center">Voir les avancÃ©es de la quÃªte ğŸ”¥</h2>
    </div>
  <% end %>
</div>

<!-- DEBUT CANDIDATURES POUR REJOINDRE VISIBLE QUE PAR CREATOR -->
    <% if @guild.creator == current_user && @guild.members.waiting.present? %>
    <div class="min-w-0 p-4 bg-white rounded-xl border border-gray-300 h-auto overflow-auto col-end-3 col-span-1">
      <h2 class="text-xl text-center">Des personnes veulent entrer dans votre guilde</h2>
      <br>
      <% @guild.members.waiting.each do |member| %>
        <div class="px-4 py-2 rounded-xl bg-gray-50 my-2">
          <strong><h3 class="text-lg"><%= member.user.username %></h3></strong>
          <p class="py-1 text-justify"><%= member.cover_letter %></p>

          <div class="text-center">
            <%= link_to "", accepted_member_path(member), class: "fas fa-check-circle", style: "color: green; font-size: 20px;" %>
            <%= link_to "", refused_member_path(member), class: "fas fa-times-circle", style: "color: red; font-size: 20px;"%>
          </div>
        </div>
        <% end %>
    </div>
    <% end %>
<!-- FIN CANDIDATURES POUR REJOINDRE VISIBLE QUE PAR CREATOR -->

</div>
  </div>
<!-- FIN DE GRID-->

<!-- BUTTON QUETE RESOLUE-->
<% if @guild.quest.resolved == false %>
<div class="mx-40 mb-20 text-center">
  <% if current_user == @guild.creator %>
    <%= link_to 'Le trÃ©sor a Ã©tÃ© trouvÃ©', quest_resolved_path(@guild), class: "btn-back mx-auto lg:mx-0 font-extrabold rounded mt-20 md:my-6 py-2 px-4 w-48n no-underline" %>
  <% end %>
</div>
<% end %>


<!-- A LAISSER EN BAS, SI T'ES PAS MEMBRE, TU VOIS RIEN -->
<% else %>
  <h2>DÃ©solÃ©, vous n'Ãªtes pas member de cette guilde ğŸ˜‰</h2>
<% end %>
</div>
