<div id="bg-dash" class="pb-20">
<div class="container">
<% if current_user.is_member_of?(@guild) %>

    <h1 class="text-center pt-16 text-2xl">Tableau de bord : <%= @guild.name %>
<!-- BUTTON MODIF GUILDE QUE PAR CREATOR-->
      <% if current_user == @guild.creator %>
        <%= link_to edit_guild_path(@guild) do %>
          <i class="fas fa-pencil-alt text-sm"></i>
        <% end %>
      <% end %>
    </h1>

<!-- GRID -->
<div class="mx-10 py-8">
   <div class="grid gap-6 mb-8 grid-cols-2">

<!-- FORMULAIRE POSTS ORGA -->
    <div class="min-w-0 p-4 bg-white rounded-xl h-80">
      <h2 class="text-xl text-center pb-1">Ajouter une publication</h2>
      <p class="pt-2"><%= simple_form_for [@guild, @post_new] do |f| %>
        <%= f.hidden_field :category, value: 'orga' %>
        <%= f.input :title, label: 'Titre', class: 'mt-1 relative rounded-md shadow-sm' %>
        <%= f.input :description, label: 'Description' %>
        <p class="text-center"><%= f.button :submit, 'Publier', class: 'btn-dash', remote: true%></p>
      <% end %></p>
    </div>


<!-- DEBUT LISTE MEMBRES DE LA GUIDE -->
  <div class="min-w-0 p-4 bg-white rounded-xl h-auto">
    <h2 class="text-xl text-center pb-3">La guilde</h2>
        <% @guild.members.each do |member| %>
          <div class="pb-4">
            <% if member.accepted == true %>
            <div class="flex items-center justify-center pb-1">
              <p class="pr-1"><%= image_tag member.user.photo, class: "avatar"%></p>
              <p class="font-medium"><%= member.user.username %></p>
            </div>
              <p class="text-center"><%= member.user.bio %></p>
            <% end %>
          </div>
        <% end %>
  </div>
<!-- FIN LISTE MEMBRES DE LA GUIDE -->


<!-- AFFICHAGE POSTS ORGA -->
  <div class="min-w-0 p-4 bg-white rounded-xl h-2/3 overflow-auto -mt-16">
    <h2 class="text-xl text-center pb-1">Les derniÃ¨res publications</h2>
      <% @guild.posts.reverse_each do |post| %>
        <% if post.category == "orga" %>
        <div class="p-3 rounded-xl bg-gray-50 my-2">
          <div class="flex items-center">
            <%= image_tag post.user.photo, class: "avatar-mini"%>
            <h3 class="text-lg pl-2"><%= post.title %></h3>
          </div>
            <p><%= post.description %></p>

          <div class="p-2">
            <% post.comments.each do |comment| %>
            <div class="bg-gray-100 my-1 rounded-xl p-2 flex items-center">
              <%= image_tag comment.user.photo, class: "avatar-mini"%>
              <p class="pl-2"><%= comment.content %></p>
            </div>
            <% end %>

            <p><%= simple_form_for [post, @comment_new] do |f| %>
              <div class="flex items-center">
                <%= f.input_field :content, label: false, placeholder: "Votre commentaire", class: 'pr-3 block w-full pl-2 pr-12 sm:text-sm border-gray-300 rounded-md' %>
                <%= button_tag type: 'submit', class: 'btn-dash py-2 px-3 rounded-sm ml-3' do %>
                  <i class="fas fa-paper-plane"></i>
                <% end %>
              <% end %>
              </div>
            </p>

          </div>
        </div>
        <% end %>
      <% end %>
    </div>

<!-- DUO DIV CARDS-->
  <div class="space-y-6">
<!-- CARD PISTE-->
  <%= link_to pistes_guild_posts_path(@guild) do %>
    <div class="block min-w-0 mb-4 p-4 bg-white rounded-xl h-40 flex items-center justify-center"
    style="background-image:url('https://image.freepik.com/free-vector/vintage-monochrome-treasure-map_225004-986.jpg'); background-position: center; box-shadow: inset 0 0 0 100vw rgba(7, 25, 43, 0.4)">
      <h2 class="text-xl text-white">Les diffÃ©rentes pistes en cours ğŸ‘€</h2>
    </div>
  <% end %>

<!-- CARD QUEST-->
  <%= link_to quest_path(@guild.quest) do %>
    <div class="block min-w-0 p-4 bg-white rounded-xl h-40 flex items-center justify-center"
      style="background-image:url('https://cdn.dribbble.com/users/59947/screenshots/12002099/media/35047050a52b5a57b806004e537b293b.jpg'); background-position: center; background-size: 100%; box-shadow: inset 0 0 0 100vw rgba(7, 25, 43, 0.4)">
      <h2 class="text-xl text-white">Voir les avancÃ©es de la quÃªte ğŸ”¥</h2>
    </div>
  <% end %>
</div>
<!-- END DUO DIV CARDS-->

<!-- DEBUT CANDIDATURES POUR REJOINDRE VISIBLE QUE PAR CREATOR -->
    <% if @guild.creator == current_user && @guild.members.waiting.present? %>
    <div class="min-w-0 p-4 bg-white rounded-xl h-auto overflow-auto col-end-3 col-span-1">
      <h2 class="text-xl text-center">Des personnes veulent entrer dans votre guilde</h2>
      <br>
      <% @guild.members.waiting.each do |member| %>
        <div class="px-4 py-2 rounded-xl bg-gray-50 my-2">
          <strong><h3 class="text-lg"><%= member.user.username %></h3></strong>
          <p class="py-1 text-justify"><%= member.cover_letter %></p>

          <div class="text-center">
            <%= link_to "", accepted_member_path(member), class: "fas fa-check-circle", style: "color: green; font-size: 20px;" %>
            <%= link_to "", refused_member_path(member), class: "fas fa-times-circle", style: "color: red; font-size: 20px;"%>
          </div>
        </div>
        <% end %>
    </div>
    <% end %>
<!-- FIN CANDIDATURES POUR REJOINDRE VISIBLE QUE PAR CREATOR -->

</div>
  </div>
<!-- FIN DE GRID-->

<!-- BUTTON QUETE RESOLUE-->
<% if @guild.quest.resolved == false %>
<div class="mx-40 text-center transform hover:scale-110 motion-reduce:transform-none hover:opacity-100">
  <% if current_user == @guild.creator %>
    <%= link_to 'Le trÃ©sor a Ã©tÃ© trouvÃ©', quest_resolved_path(@guild), class: "btn-find mx-auto lg:mx-0 font-extrabold rounded mt-20 md:my-6 py-2 px-4 w-48n no-underline" %>
  <% end %>
</div>
<% end %>

<!-- A LAISSER EN BAS, SI T'ES PAS MEMBRE, TU VOIS RIEN -->
<% else %>
  <h2>DÃ©solÃ©, vous n'Ãªtes pas member de cette guilde ğŸ˜‰</h2>
<% end %>

</div>
</div>
